# user specified parameters
<<include /home/felipe/PIPEBOX_WORK/config/felipe_cfg.des>> 

<<include /home/felipe/DESDM-Code/devel/PipeBox/trunk/libwcl/Y3MEdev/modulewcl/modnamepat.wcl>>
<<include /home/felipe/DESDM-Code/devel/PipeBox/trunk/libwcl/Y3MEdev/modulewcl/multiepoch/01-query_tileinfo.wcl>>
<<include /home/felipe/DESDM-Code/devel/PipeBox/trunk/libwcl/Y3MEdev/modulewcl/multiepoch/02-find_ccds_in_tile.wcl>>
<<include /home/felipe/DESDM-Code/devel/PipeBox/trunk/libwcl/Y3MEdev/modulewcl/multiepoch/03-make_swarp_weights.wcl>>
<<include /home/felipe/DESDM-Code/devel/PipeBox/trunk/libwcl/Y3MEdev/modulewcl/multiepoch/04-call_swarp.wcl>>
<<include /home/felipe/DESDM-Code/devel/PipeBox/trunk/libwcl/Y3MEdev/modulewcl/multiepoch/05-call_stiff.wcl>>
<<include /home/felipe/DESDM-Code/devel/PipeBox/trunk/libwcl/Y3MEdev/modulewcl/multiepoch/06-call_sexpsf.wcl>>
<<include /home/felipe/DESDM-Code/devel/PipeBox/trunk/libwcl/Y3MEdev/modulewcl/multiepoch/07-call_psfex.wcl>>
<<include /home/felipe/DESDM-Code/devel/PipeBox/trunk/libwcl/Y3MEdev/modulewcl/multiepoch/08-call_sexdual.wcl>>
<<include /home/felipe/DESDM-Code/devel/PipeBox/trunk/libwcl/Y3MEdev/modulewcl/multiepoch/09-make_mef.wcl>>
 
# Database dependant definitions
submit_des_db_section = db-destest     # submit section: db-desoper or db-destest
target_des_db_section = db-destest     # target section: db-desoper or db-destest
home_archive          = prodbeta  # i.e. prodbeta or desar2home for destest/desoper
des_http_section      = file-http-prodbeta   # need to define in .desservices file (i.e file-http-prodbeta)


reqnum      = 1043         # jira id - used as part of a unique identifier
jira_id     = DESOPS-1043  # the parent id of the reqnum
label       = me           # me-tests,,for-user-tests #strings to help identify runs

pipeline = multiepoch        # used in desstat output 
pipeprod = Y2ME     # i.e. Y2Nstack       #eups stack name
pipever  = dev+2    # 1.0.6+1, the eups stack version
campaign = METEST   # Y2T for example
project  = FM       # i.e ACT/FM/MCK as user tests can be done under your own project
ops_run_dir    = ${project}/${pipeline}/${tilename}-r${reqnum}/p${attnum:2}
submit_run_dir = /cluster_scratch/refact/submit/${home_archive}/${ops_run_dir}/

# ----------------------
# multi-epoch options
# ----------------------

# General options
tilename                 = DES2246-4457
tilename_fh_var          = ${tilename}_r${reqnum}p${attnum:2}
archive_name_var         = prodbeta  # i.e. prodbeta or desar2home for destest/desoper
execution_mode_var       = execute # tofile or dryrun
tiledir_var       = ./
ncpu = 8

# Path Cosmology settings
target_site              = descmp4-dev  # ie. descmp4, iforge, fermigrid-sl6, bluewaters-dev
local_archive_var        = /work/prodbeta/archive
local_weight_archive_var = /work/devel/felipe/MULTIEPOCH_ROOT/LOCAL_WEIGHTS 

# Path BW settings
#target_site              = bluewaters-dev  # ie. descmp4, iforge, fermigrid-sl6, bluewaters-dev
#local_archive_var        = /projects/sciteam/jrr/project/des/LOCAL_ARCHIVE
#local_weight_archive_var = /projects/sciteam/jrr/project/des/LOCAL_WEIGHTS 

# Geom and CCD Queries
db_section_var      = ${target_des_db_section}
tagname_var         = Y2T_FIRSTCUT
coaddtile_table_var = felipe.coaddtile_new
select_extras_var   = "felipe.extraZEROPOINT.MAG_ZERO,"
from_extras_var     = "felipe.extraZEROPOINT,felipe.TAGS"
and_extras_var      = "felipe.extraZEROPOINT.FILENAME=image.FILENAME, felipe.TAGS.FILENAME=image.FILENAME and felipe.TAGS.TAG='DES2246-4457_RAN_EXP'"

# Custom Weights
mp_weight_var        = 6
weight_extension_var = _wgt

# SWarp options
magbase_var          = 30
swarp_parameters_var = NTHREADS=8 COMBINE_TYPE=AVERAGE COPY_KEYWORDS=OBJECT,EXPTIME

# TODO:
# We might want to do $optical_bands = $band,$detname ?

#band                 = g,r,i,z,Y,det # Order is important, det needs to be the last one
band                 = r,i,z,det # Order is important, det needs to be the last one
dobands_var          = ${band} 
detecbands_var       = r i z  # Bands used for detection      
detname_var          = det    # Detection image label
swarp_execution_mode_var = ${execution_mode_var}

# Stiff options
stiff_execution_mode_var = ${execution_mode_var}
stiff_parameters_var     = NTHREADS=8

# SExpsf options
sexpsf_execution_mode_var = ${execution_mode_var}
sexpsf_parameters_var     = VERBOSE_TYPE=NORMAL
mp_sex_var                = ${ncpu}

# psfex options
psfex_execution_mode_var = ${execution_mode_var}
psfex_parameters_var     = NTHREADS=8

# SExDual options
sexdual_execution_mode_var = ${execution_mode_var}
sexdual_parameters_var     = VERBOSE_TYPE=NORMAL WRITE_XML=N

# make MEF options
mef_execution_mode_var = ${execution_mode_var}

basket   = ${tilename} 
unitname = ${tilename}

blocklist = multiepoch

<block>
  <multiepoch>
    modulelist = query_tileinfo,find_ccds_in_tile,make_swarp_weights,call_swarp,call_stiff,call_sexpsf,call_psfex,call_sexdual,make_mef
    #modulelist = query_tileinfo,find_ccds_in_tile,make_swarp_weights,call_swarp
 </multiepoch>
</block>
